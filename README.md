This repository contains several programs to assist with the calibration of ship-mounted fisheries omni-sonar systems that produce data in the SONAR-netCDF4 format. The programs are:
- [do_sonar_calibration.py](#sonarCal) - assists with real-time calibration
- [do_estimate_gains.py](#estimate-gains) - estimates gains from existing calibration data
- [do_add_calibration.py](#add-gains) - add calibration to existing sonar files
- [fix_furuno_files.py](#fix-furuno-files) - fix a problem with some Furuno omni-sonar files

# Installation

All of the programs can be run from the command line (e.g., Anaconda Prompt if under Windows). Some of the programs use configuration files - these should be in the same directory as the program itself. The programs all use Python3 and some additional libraries that may need to be added to your Python installation:
- numpy
- matplotlib
- scipy
- h5py
- netCDF4 
- pandas
- cftime

# sonarCal
This program assists with the standard sphere calibration of omni-directional fisheries sonars. It provides a real-time display of sonar data that helps with moving a calibration sphere into the centre of a sonar beam.

## Usage

The program has one window:

![screenshot](screenshot.png "Main (only) window")

The two range rings and radial line on the omni echogram can be moved with the mouse (click and drag)
to select the beam being calibrated and the range bounds of the calibration sphere. Changing these alters what is shown in the other echograms and plots.

## Configuration

Configuration of the program is done by editing the config file (called ``sonar_calibration.ini`` and located in the same directory as the program). The config parameters are:
- The directory where the sonar data files are created by the sonar (``watchDir``),
- The location of log files (``logDir``),
- The NetCDF4 group name for the horizontal sonar beams (``horizontalBeamGroupPath``),
- Whether to expect live data or whether to replay all the pings in the last file in ``watchDir`` (``liveData`` - set to ``yes`` or ``no``),
- The number of pings shown in the echograms (``numPingsToShow``),
- The maximum range of the echograms (``maxRange``), and
- The mininium and maximum Sv values used in the colormap (``minSv`` and ``maxSv``).

# Estimate gains

This program ...

# Add gains

This program replaces the contents of the ``gain_correction`` variable in the SONAR-netCDF4 files with a user-speficied value. Configuration is done via the ``gain_calibration.ini`` file.

# Fix Furuno files

This program corrects a problem with files generated by Furuno omni-sonars where some of the vertical beam variables contain 128 beams when they should only have 64 beams. The need for this program will disappear with future versions of the Furuno software.